<!DOCTYPE html><html lang="cn" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>防火墙技术 | My Blog</title><meta name="author" content="Yang"><meta name="copyright" content="Yang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一、iptables 内置4个表   raw表 mangle表 nat表 filter表    数据跟踪处理 包重构（修改） 网络地址转换 包过滤   12345678910111213141516171819202122232425262728293031323334353637规则表1.filter表——三个链：INPUT、FORWARD、OUTPUT。作用：过滤数据包内核模块：iptable">
<meta property="og:type" content="article">
<meta property="og:title" content="防火墙技术">
<meta property="og:url" content="http://yclyyds.top/2023/10/26/%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/index.html">
<meta property="og:site_name" content="My Blog">
<meta property="og:description" content="一、iptables 内置4个表   raw表 mangle表 nat表 filter表    数据跟踪处理 包重构（修改） 网络地址转换 包过滤   12345678910111213141516171819202122232425262728293031323334353637规则表1.filter表——三个链：INPUT、FORWARD、OUTPUT。作用：过滤数据包内核模块：iptable">
<meta property="og:locale">
<meta property="og:image" content="http://yclyyds.top/img/four.png">
<meta property="article:published_time" content="2023-10-26T06:38:05.449Z">
<meta property="article:modified_time" content="2023-10-26T08:29:46.063Z">
<meta property="article:author" content="Yang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yclyyds.top/img/four.png"><link rel="shortcut icon" href="/img/four.png"><link rel="canonical" href="http://yclyyds.top/2023/10/26/%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '防火墙技术',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-10-26 16:29:46'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/four.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">9</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><hr class="custom-hr"/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="My Blog"><span class="site-name">My Blog</span></a></span><div id="menus"><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">防火墙技术</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-10-26T06:38:05.449Z" title="Created 2023-10-26 14:38:05">2023-10-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-10-26T08:29:46.063Z" title="Updated 2023-10-26 16:29:46">2023-10-26</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="防火墙技术"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="一、iptables-内置4个表"><a href="#一、iptables-内置4个表" class="headerlink" title="一、iptables 内置4个表"></a>一、iptables 内置4个表</h2><table>
<thead>
<tr>
<th align="center">raw表</th>
<th align="center">mangle表</th>
<th align="center">nat表</th>
<th align="center">filter表</th>
</tr>
</thead>
<tbody><tr>
<td align="center">数据跟踪处理</td>
<td align="center">包重构（修改）</td>
<td align="center">网络地址转换</td>
<td align="center">包过滤</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">规则表</span><br><span class="line"></span><br><span class="line">1.filter表——三个链：INPUT、FORWARD、OUTPUT。</span><br><span class="line"></span><br><span class="line">作用：过滤数据包</span><br><span class="line"></span><br><span class="line">内核模块：iptables_filter</span><br><span class="line"></span><br><span class="line">2.Nat表——三个链：PREROUTING、POSTROUTING、OUTPUT</span><br><span class="line"></span><br><span class="line">作用：用于网络地址转换（IP、端口）</span><br><span class="line"></span><br><span class="line">内核模块：iptable_nat</span><br><span class="line"></span><br><span class="line">3.Mangle表——五个链：PREROUTING、POSTROUTING、INPUT、OUTPUT、FORWARD</span><br><span class="line"></span><br><span class="line">作用：修改数据包的服务类型、TTL、并且可以配置路由实现QOS</span><br><span class="line"></span><br><span class="line">内核模块：iptable_mangle</span><br><span class="line"></span><br><span class="line">4.Raw表——两个链：OUTPUT、PREROUTING</span><br><span class="line"></span><br><span class="line">作用：决定数据包是否被状态跟踪机制处理</span><br><span class="line"></span><br><span class="line">内核模块：iptable_raw</span><br><span class="line"></span><br><span class="line">规则链</span><br><span class="line"></span><br><span class="line">1.INPUT——进来的数据包应用此规则链中的策略；</span><br><span class="line"></span><br><span class="line">2.OUTPUT——外出的数据包应用此规则链中的策略；</span><br><span class="line"></span><br><span class="line">3.FORWARD——转发数据包时应用此规则链中的策略；</span><br><span class="line"></span><br><span class="line">4.PREROUTING——对数据包作路由选择前应用此链中的规则；</span><br><span class="line"></span><br><span class="line">5.POSTROUTING——对数据包作路由选择后应用此链中的规则。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">iptables语法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">语法：iptables [-t table] command [match] [-j target/jump]</span><br><span class="line"></span><br><span class="line">1）[-t table] 指定规则表</span><br><span class="line"></span><br><span class="line">-t 参数用来，内建的规则表有三个，分别是：nat、mangle 和 filter，当未指定规则表时，则一律视为是 filter。个规则表的功能如下：</span><br><span class="line"></span><br><span class="line">nat：此规则表拥有 PREROUTING 和 POSTROUTING 两个规则链，主要功能为进行一对一、一对多、多对多等网址转换工作（SNAT、DNAT），这个规则表除了作网址转换外，请不要做其它用途。</span><br><span class="line"></span><br><span class="line">mangle：此规则表拥有 PREROUTING、FORWARD 和 POSTROUTING 三个规则链。除了进行网址转换工作会改写封包外，在某些特殊应用可能也必须去改写封包（TTL、TOS）或者是设定markMARK（将封包作记号，以进行后续的过滤），这时就必须将这些工作定义在 mangle 规则表中，由于使用率不高，这里不讨论 mangle 的用法。</span><br><span class="line"></span><br><span class="line">filter：这个规则表是默认规则表，拥有 INPUT、FORWARD 和 OUTPUT 三个规则链，这个规则表顾名思义是用来进行封包过滤的处理动作（例如：DROP、 LOG、 ACCEPT 或 REJECT），需要将基本规则都建立在此规则表中。</span><br><span class="line"></span><br><span class="line">2）command 常用命令列表：</span><br><span class="line"></span><br><span class="line">命令：-A, --append；范例：iptables -A INPUT ...；说明：新增规则到某个规则链中，该规则将会成为规则链中的最后一条规则。</span><br><span class="line"></span><br><span class="line">命令：-D, --delete；范例：iptables -D INPUT --dport 80 -j DROP，iptables -D INPUT 1；说明：从某个规则链中删除一条规则，可以输入完整规则，或直接指定规则编号加以删除。</span><br><span class="line"></span><br><span class="line">命令：-R, --replace；范例：iptables -R INPUT 1 -s 192.168.0.1 -j DROP；说明：取代现行规则，规则被取代后并不会改变顺序。</span><br><span class="line"></span><br><span class="line">命令：-I, --insert；范例：iptables -I INPUT 1 --dport 80 -j ACCEPT；说明：插入一条规则，原本该位置上的规则将会往后移动一个顺位。</span><br><span class="line"></span><br><span class="line">命令：-L, --list；范例1 ：iptables -L INPUT，说明： 列出某规则链中的所有规则；范例2：iptables -t nat -L ，说明：列出nat表所有链中的所有规则。</span><br><span class="line"></span><br><span class="line">命令：-F, --flush；范例：iptables -F INPUT；说明：删除filter表中INPUT链的所有规则。</span><br><span class="line"></span><br><span class="line">命令：-Z, --zero；范例：iptables -Z INPUT；说明：将封包计数器归零。封包计数器是用来计算同一封包出现次数，是过滤阻断式攻击不可或缺的工具。</span><br><span class="line"></span><br><span class="line">命令：-N, --new-chain；范例：iptables -N allowed；说明：定义新的规则链。</span><br><span class="line"></span><br><span class="line">命令：-X, --delete-chain；范例：iptables -X allowed；说明：删除某个规则链。</span><br><span class="line"></span><br><span class="line">命令： -P, --policy；范例：iptables -P INPUT DROP；说明：定义过滤政策。 也就是未符合过滤条件之封包， 默认的处理方式。</span><br><span class="line"></span><br><span class="line">命令：-E, --rename-chain；范例：iptables -E allowed disallowed；说明：修改某自定义规则链的名称。</span><br><span class="line"></span><br><span class="line">3）[match] 常用封包匹配参数</span><br><span class="line"></span><br><span class="line">参数：-p, --protocol；范例：iptables -A INPUT -p tcp；说明：匹配通讯协议类型是否相符，可以使用 ! 运算符进行反向匹配，例如：-p !tcp，意思是指除 tcp 以外的其它类型，如udp、icmp等；如果要匹配所有类型，则可以使用 all 关键词，例如：-p all。</span><br><span class="line"></span><br><span class="line">参数：-s, --src, --source；范例：iptables -A INPUT -s 192.168.1.1；说明：用来匹配封包的来源 IP，可以匹配单机或网络，匹配网络时请用数字来表示 子网掩码，例如：-s 192.168.0.0/24，匹配 IP 时可以使用 ! 运算符进行反向匹配，例如：-s !192.168.0.0/24。</span><br><span class="line"></span><br><span class="line">参数：-d, --dst, --destination；范例：iptables -A INPUT -d 192.168.1.1；说明：用来匹配封包的目的地 IP，设定方式同上。</span><br><span class="line"></span><br><span class="line">参数：-i, --in-interface；范例：iptables -A INPUT -i eth0；说明：用来匹配封包是从哪块网卡进入，可以使用通配字符 + 来做大范围匹配，例如：-i eth+ 表示所有的 ethernet 网卡，也可以使用 ! 运算符进行反向匹配，例如：-i !eth0。</span><br><span class="line"></span><br><span class="line">参数：-o, --out-interface；范例：iptables -A FORWARD -o eth0；说明：用来匹配封包要从哪 块网卡送出，设定方式同上。</span><br><span class="line"></span><br><span class="line">参数：--sport, --source-port；范例：iptables -A INPUT -p tcp --sport 22；说明：用来匹配封包的源端口，可以匹配单一端口，或是一个范围，例如：--sport 22:80表示从 22 到 80 端口之间都算是符合条件，如果要匹配不连续的多个端口，则必须使用 --multiport 参数，详见后文。匹配端口号时，可以使用 ! 运算符进行反向匹配。</span><br><span class="line"></span><br><span class="line">参数：--dport, --destination-port；范例：iptables -A INPUT -p tcp --dport 22；说明：用来匹配封包的目的地端口号，设定方式同上</span><br><span class="line"></span><br><span class="line">参数：--tcp-flags；范例：iptables -p tcp --tcp-flags SYN,FIN,ACK SYN；说明：匹配 TCP 封包的状态标志，参数分为两个部分，第一个部分列举出想 匹配的标志，第二部分则列举前述标志中哪些有被设置，未被列举的标志必须是空的。TCP 状态标志包括：SYN（同步）、ACK（应答）、FIN（结束）、RST（重设）、URG（紧急） 、PSH（强迫推送） 等均可使用于参数中，除此之外还可以使用关键词 ALL 和 NONE 进行匹配。匹配标志时，可以使用 ! 运算符行反向匹配。</span><br><span class="line"></span><br><span class="line">参数：--syn；范例：iptables -p tcp --syn；说明：用来表示TCP通信协议中，SYN位被打开，而ACK与FIN位关闭的分组，即TCP的初始连接，与 iptables -p tcp --tcp-flags SYN,FIN,ACK SYN 的作用完全相同，如果使用 !运算符，可用来 匹配非要求连接封包。</span><br><span class="line"></span><br><span class="line">参数：-m multiport --source-port；范例：iptables -A INPUT -p tcp -m multiport --source-port 22,53,80,110；说明：用来匹配不连续的多个源端口，一次最多可以匹配 15 个端口，可以使用 ! 运算符进行反向匹配。</span><br><span class="line"></span><br><span class="line">参数：-m multiport --destination-port；范例：iptables -A INPUT -p tcp -m multiport --destination-port 22,53,80,110；说明：用来匹配不连续的多个目的地端口号，设定方式同上。</span><br><span class="line"></span><br><span class="line">参数：-m multiport --port；范例：iptables -A INPUT -p tcp -m multiport --port 22,53,80,110；说明：这个参数比较特殊，用来匹配源端口和目的端口号相同的封包，设定方式同上。注意：在本范例中，如果来源端口号为 80目的地端口号为 110，这种封包并不算符合条件。</span><br><span class="line"></span><br><span class="line">参数：--icmp-type；范例：iptables -A INPUT -p icmp --icmp-type 8；说明：用来匹配 ICMP 的类型编号，可以使用代码或数字编号来进行 匹配。请打 iptables -p icmp --help 来查看有哪些代码可用。</span><br><span class="line"></span><br><span class="line">参数：-m limit --limit；范例：iptables -A INPUT -m limit --limit 3/hour；说明：用来匹配某段时间内封包的平均流量，上面的例子是用来 匹配：每小时平均流量是否超过一次 3 个封包。 除了每小时平均次外，也可以每秒钟、每分钟或每天平均一次，默认值为每小时平均一次，参数如后： /second、 /minute、/day。 除了进行封 包数量的匹配外，设定这个参数也会在条件达成时，暂停封包的匹配动作，以避免因骇客使用洪水攻击法，导致服务被阻断。</span><br><span class="line"></span><br><span class="line">参数：--limit-burst；范例：iptables -A INPUT -m limit --limit-burst 5；说明：用来匹配瞬间大量封包的数量，上面的例子是用来匹配一次同时涌入的封包是否超过 5 个（这是默认值），超过此上限的封包将被直接丢弃。使用效果同上。</span><br><span class="line"></span><br><span class="line">参数：-m mac --mac-source；范例：iptables -A INPUT -m mac --mac-source 00:00:00:00:00:01；说明：用来匹配封包来源网络接口的硬件地址，这个参数不能用在 OUTPUT 和 POSTROUTING 规则链上，这是因为封包要送到网 卡后，才能由网卡驱动程序透过 ARP 通讯协议查出目的地的 MAC 地址，所以 iptables 在进行封包匹配时，并不知道封包会送到哪个网络接口去。</span><br><span class="line"></span><br><span class="line">参数：--mark；范例：iptables -t mangle -A INPUT -m mark --mark 1；说明：用来匹配封包是否被表示某个号码，当封包被匹配成功时，可以透过 MARK 处理动作，将该封包标示一个号码，号码最大不可以超过 4294967296。</span><br><span class="line"></span><br><span class="line">参数：-m owner --uid-owner；范例：iptables -A OUTPUT -m owner --uid-owner 500；说明：用来匹配来自本机的封包，是否为某特定使用者所产生的，这样可以避免服务器使用 root 或其它身分将敏感数据传送出，可以降低系统被骇的损失。可惜这个功能无法 匹配出来自其它主机的封包。</span><br><span class="line"></span><br><span class="line">参数：-m owner --gid-owner；范例：iptables -A OUTPUT -m owner --gid-owner 0；说明：用来匹配来自本机的封包，是否为某特定使用者群组所产生的，使用时机同上。</span><br><span class="line"></span><br><span class="line">参数：-m owner --pid-owner；范例：iptables -A OUTPUT -m owner --pid-owner 78；说明：用来匹配来自本机的封包，是否为某特定进程所产生的，使用时机同上。</span><br><span class="line"></span><br><span class="line">参数：m owner --sid-owner；范例：iptables -A OUTPUT -m owner --sid-owner 100；说明：用来匹配来自本机的封包，是否为某特定 连接（Session ID）的响应封包，使用时机同上。</span><br><span class="line"></span><br><span class="line">参数：-m state --state；范例：iptables -A INPUT -m state --state RELATED,ESTABLISHED；说明：用来匹配连接状态， 连接状态共有四种：INVALID、ESTABLISHED、NEW 和 RELATED。</span><br><span class="line"></span><br><span class="line">INVALID 表示该封包的连接编号（Session ID）无法辨识或编号不正确。</span><br><span class="line"></span><br><span class="line">ESTABLISHED 表示该封包属于某个已经建立的连接。</span><br><span class="line"></span><br><span class="line">NEW 表示该封包想要起始一个连接（重设连接或将连接重导向）。</span><br><span class="line"></span><br><span class="line">RELATED 表示该封包是属于某个已经建立的连接，所建立的新连接。例如：FTP-DATA 连接必定是源自某个 FTP 连接。</span><br></pre></td></tr></table></figure>

<h2 id="二、netstat语法"><a href="#二、netstat语法" class="headerlink" title="二、netstat语法"></a>二、netstat语法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">netstat语法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NETSTAT [-a] [-b] [-e] [-n] [-o] [-p proto] [-r] [-s] [-v] [interval]</span><br><span class="line"></span><br><span class="line">Netstat命令用于显示各种网络相关信息，如网络连接，路由表，接口状态 (Interface Statistics)，masquerade 连接，多播成员 (Multicast Memberships) 等等。</span><br><span class="line"></span><br><span class="line">-a   （all）显示所有选项，默认不显示LISTEN相关</span><br><span class="line"></span><br><span class="line">-t   （tcp）仅显示tcp相关选项</span><br><span class="line"></span><br><span class="line">-u   （udp）仅显示udp相关选项</span><br><span class="line"></span><br><span class="line">-n   拒绝显示别名，能显示数字的全部转化成数字</span><br><span class="line"></span><br><span class="line">-l   仅列出有在 Listen (监听) 的服務状态</span><br><span class="line"></span><br><span class="line">-p   显示建立相关链接的程序名</span><br><span class="line"></span><br><span class="line">-r   显示路由信息，路由表</span><br><span class="line"></span><br><span class="line">-e   显示扩展信息，例如uid等</span><br><span class="line"></span><br><span class="line">-s   按各个协议进行统计</span><br><span class="line"></span><br><span class="line">-c   每隔一个固定时间，执行该netstat命令</span><br><span class="line"></span><br><span class="line">提示：LISTEN和LISTENING的状态只有用-a或者-l才能看到</span><br><span class="line"></span><br><span class="line">1）列出所有端口（包括监听和未监听的）</span><br><span class="line"></span><br><span class="line">列出所有端口 netstat -a</span><br><span class="line"></span><br><span class="line">列出所有 tcp 端口 netstat -at</span><br><span class="line"></span><br><span class="line">列出所有 udp 端口 netstat -au</span><br><span class="line"></span><br><span class="line">2）列出所有处于监听状态的 Sockets</span><br><span class="line"></span><br><span class="line">只显示监听端口 netstat -l</span><br><span class="line"></span><br><span class="line">只列出所有监听 tcp 端口 netstat -lt</span><br><span class="line"></span><br><span class="line">只列出所有监听 udp 端口 netstat -lu</span><br><span class="line"></span><br><span class="line">只列出所有监听 UNIX 端口 netstat -lx</span><br><span class="line"></span><br><span class="line">3）显示每个协议的统计信息</span><br><span class="line"></span><br><span class="line">显示所有端口的统计信息 netstat -s</span><br><span class="line"></span><br><span class="line">显示TCP端口的统计信息 netstat -st</span><br><span class="line"></span><br><span class="line">显示UDP端口的统计信息 netstat - su</span><br><span class="line"></span><br><span class="line">4）在 netstat 输出中显示 PID 和进程名称 netstat -p</span><br><span class="line"></span><br><span class="line">netstat -p 可以与其它开关一起使用，就可以添加 “PID/进程名称” 到 netstat 输出中，这样 debugging 的时候可以很方便的发现特定端口运行的程序。</span><br><span class="line"></span><br><span class="line">5）在 netstat 输出中不显示主机，端口和用户名（host, port or user）</span><br><span class="line"></span><br><span class="line">当不想让主机，端口和用户名显示，使用 netstat -n。将会使用数字代替那些名称。</span><br><span class="line"></span><br><span class="line">同样可以加速输出，因为不用进行比对查询。</span><br></pre></td></tr></table></figure>

<h2 id="三、iptables常用命令加固"><a href="#三、iptables常用命令加固" class="headerlink" title="三、iptables常用命令加固"></a>三、iptables常用命令加固</h2><h3 id="2-查看iptables状态"><a href="#2-查看iptables状态" class="headerlink" title="2.查看iptables状态"></a>2.查看iptables状态</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service iptables status</span><br></pre></td></tr></table></figure>

<h3 id="3-保存iptables规则"><a href="#3-保存iptables规则" class="headerlink" title="3.保存iptables规则"></a>3.保存iptables规则</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/iptables  save</span><br></pre></td></tr></table></figure>

<h3 id="4-清除iptables规则"><a href="#4-清除iptables规则" class="headerlink" title="4.清除iptables规则"></a>4.清除iptables规则</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -F</span><br></pre></td></tr></table></figure>

<h3 id="5-禁用ping规则"><a href="#5-禁用ping规则" class="headerlink" title="5.禁用ping规则"></a>5.禁用ping规则</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p icmp -j DROP</span><br></pre></td></tr></table></figure>

<h3 id="6-目的端口不可达"><a href="#6-目的端口不可达" class="headerlink" title="6.目的端口不可达"></a>6.目的端口不可达</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p icmp -j  REJECT</span><br></pre></td></tr></table></figure>

<h3 id="7-防洪水攻击"><a href="#7-防洪水攻击" class="headerlink" title="7.防洪水攻击"></a>7.防洪水攻击</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport  端口  -j DROP   //关闭端口tcp访问</span><br></pre></td></tr></table></figure>

<h3 id="8-利用recent模块防御ssh字典攻击"><a href="#8-利用recent模块防御ssh字典攻击" class="headerlink" title="8.利用recent模块防御ssh字典攻击"></a>8.利用recent模块防御ssh字典攻击</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">iptables的recent模块可以根据源地址、目的地址对最近一段时间内经过本机的数据包的情况进行统计，并根据相应的规则执行，命令如下：</span><br><span class="line"></span><br><span class="line">--name   #设定列表名称，默认DEFAULT</span><br><span class="line"></span><br><span class="line">--rsource   #源地址，此为默认</span><br><span class="line"></span><br><span class="line">--rdest   #目的地址</span><br><span class="line"></span><br><span class="line">--seconds   #指定时间内</span><br><span class="line"></span><br><span class="line">--hitcount   #命中次数</span><br><span class="line"></span><br><span class="line">--set   #将地址添加进列表，并更新信息，包含地址加入的时间戳</span><br><span class="line"></span><br><span class="line">--rcheck   #检查地址是否在列表，以第一个匹配开始计算时间</span><br><span class="line"></span><br><span class="line">--update   #和rcheck类似，以最后一个匹配计算时间</span><br><span class="line"></span><br><span class="line">--remove   #在列表里删除相应地址，后跟列表名称及地址</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 22  -m state --state NEW -m recent --name SSHPOOL --update --seconds 60 --hitcount 3 -j DROP </span><br><span class="line">iptables -A INPUT -p tcp --dport 22  -m state --state NEW -m recent --name SSHPOOL --set -j ACCEPT</span><br><span class="line">解释：</span><br><span class="line">•当这个电脑的第1个SSH包到达本机，规则a检查SSHPOOL列表中这个源IP是否有hitcount，因为是第一个包，显而易见，列表是0，规则a判定这个数据包不必执行DROP，并且也不处理这个数据包，将数据包转给下条规则；</span><br><span class="line"></span><br><span class="line">•规则b将这个数据包计入SSHPOOL列表，就是做+1，因为规则中有-j ACCEPT，规则b放行这个包；</span><br><span class="line"></span><br><span class="line">•当第2个SSH包到达本机，规则a检查SSHPOOL列表的hitcount，发现没有超过3，于是判定不执行DROP并转给下条规则处理；</span><br><span class="line"></span><br><span class="line">•规则b在SSHPOOL中+1，并放行，第2个数据包进入本机；</span><br><span class="line"></span><br><span class="line">•第3个数据包过程如上；</span><br><span class="line"></span><br><span class="line">•第4个包到达本机，规则a检查SSHPOOL列表中的hitcount，发现是3了已经连接3次了，于是执行DROP，不必再转给下条规则了丢弃该包。</span><br></pre></td></tr></table></figure>

<h3 id="9-允许某个ip访问某个端口"><a href="#9-允许某个ip访问某个端口" class="headerlink" title="9.允许某个ip访问某个端口"></a>9.允许某个ip访问某个端口</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line">这篇文章主要介绍了iptables防火墙只允许指定ip连接指定端口、访问指定网站,需要的朋友可以参考下</span><br><span class="line"></span><br><span class="line">需要开80端口，指定IP和局域网</span><br><span class="line"></span><br><span class="line">下面三行的意思：</span><br><span class="line"></span><br><span class="line">先关闭所有的80端口</span><br><span class="line"></span><br><span class="line">开启ip段192.168.1.0/24端的80口</span><br><span class="line"></span><br><span class="line">开启ip段211.123.16.123/24端ip段的80口</span><br><span class="line"></span><br><span class="line"># iptables -I INPUT -p tcp --dport 80 -j DROP </span><br><span class="line"> # iptables -I INPUT -s 192.168.1.0/24 -p tcp --dport 80 -j ACCEPT</span><br><span class="line"> # iptables -I INPUT -s 211.123.16.123/24 -p tcp --dport 80 -j ACCEPT</span><br><span class="line"></span><br><span class="line">以上是临时设置。</span><br><span class="line"></span><br><span class="line">1.先备份iptables</span><br><span class="line"></span><br><span class="line"># cp /etc/sysconfig/iptables /var/tmp</span><br><span class="line"></span><br><span class="line">2.然后保存iptables</span><br><span class="line"></span><br><span class="line"># service iptables save</span><br><span class="line"></span><br><span class="line">3.重启防火墙</span><br><span class="line"></span><br><span class="line">#service iptables restart</span><br><span class="line"></span><br><span class="line">以下是端口，先全部封再开某些的IP</span><br><span class="line"></span><br><span class="line">iptables -I INPUT -p tcp --dport 9889 -j DROP</span><br><span class="line"> iptables -I INPUT -s 192.168.1.0/24 -p tcp --dport 9889 -j ACCEPT</span><br><span class="line"> 如果用了NAT转发记得配合以下才能生效</span><br><span class="line"></span><br><span class="line">iptables -I FORWARD -p tcp --dport 80 -j DROP</span><br><span class="line"> iptables -I FORWARD -s 192.168.1.0/24 -p tcp --dport 80 -j ACCEPT</span><br><span class="line"></span><br><span class="line">常用的IPTABLES规则如下：</span><br><span class="line"></span><br><span class="line">只能收发邮件，别的都关闭</span><br><span class="line"> iptables -I Filter -m mac --mac-source 00:0F:EA:25:51:37 -j DROP</span><br><span class="line"> iptables -I Filter -m mac --mac-source 00:0F:EA:25:51:37 -p udp --dport 53 -j ACCEPT</span><br><span class="line"> iptables -I Filter -m mac --mac-source 00:0F:EA:25:51:37 -p tcp --dport 25 -j ACCEPT</span><br><span class="line"> iptables -I Filter -m mac --mac-source 00:0F:EA:25:51:37 -p tcp --dport 110 -j ACCEPT</span><br><span class="line"></span><br><span class="line">IPSEC NAT 策略</span><br><span class="line"> iptables -I PFWanPriv -d 192.168.100.2 -j ACCEPT</span><br><span class="line"> iptables -t nat -A PREROUTING -p tcp --dport 80 -d $INTERNET_ADDR -j DNAT --to-destination 192.168.100.2:80</span><br><span class="line"></span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 1723 -d $INTERNET_ADDR -j DNAT --to-destination 192.168.100.2:1723</span><br><span class="line"></span><br><span class="line">iptables -t nat -A PREROUTING -p udp --dport 1723 -d $INTERNET_ADDR -j DNAT --to-destination 192.168.100.2:1723</span><br><span class="line"></span><br><span class="line">iptables -t nat -A PREROUTING -p udp --dport 500 -d $INTERNET_ADDR -j DNAT --to-destination 192.168.100.2:500</span><br><span class="line"></span><br><span class="line">iptables -t nat -A PREROUTING -p udp --dport 4500 -d $INTERNET_ADDR -j DNAT --to-destination 192.168.100.2:4500</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> FTP服务器的NAT</span><br><span class="line"> iptables -I PFWanPriv -p tcp --dport 21 -d 192.168.100.200 -j ACCEPT</span><br><span class="line"> iptables -t nat -A PREROUTING -p tcp --dport 21 -d $INTERNET_ADDR -j DNAT --to-destination 192.168.100.200:21</span><br><span class="line"></span><br><span class="line">只允许访问指定网址</span><br><span class="line"> iptables -A Filter -p udp --dport 53 -j ACCEPT</span><br><span class="line"> iptables -A Filter -p tcp --dport 53 -j ACCEPT</span><br><span class="line"> iptables -A Filter -d www.3322.org -j ACCEPT</span><br><span class="line"> iptables -A Filter -d img.cn99.com -j ACCEPT</span><br><span class="line"> iptables -A Filter -j DROP</span><br><span class="line"></span><br><span class="line">开放一个IP的一些端口，其它都封闭</span><br><span class="line"> iptables -A Filter -p tcp --dport 80 -s 192.168.100.200 -d www.pconline.com.cn -j ACCEPT</span><br><span class="line"> iptables -A Filter -p tcp --dport 25 -s 192.168.100.200 -j ACCEPT</span><br><span class="line"> iptables -A Filter -p tcp --dport 109 -s 192.168.100.200 -j ACCEPT</span><br><span class="line"> iptables -A Filter -p tcp --dport 110 -s 192.168.100.200 -j ACCEPT</span><br><span class="line"> iptables -A Filter -p tcp --dport 53 -j ACCEPT</span><br><span class="line"> iptables -A Filter -p udp --dport 53 -j ACCEPT</span><br><span class="line"> iptables -A Filter -j DROP</span><br><span class="line"></span><br><span class="line">多个端口</span><br><span class="line"> iptables -A Filter -p tcp -m multiport --destination-port 22,53,80,110 -s 192.168.20.3 -j REJECT</span><br><span class="line"></span><br><span class="line">连续端口</span><br><span class="line"> iptables -A Filter -p tcp -m multiport --source-port 22,53,80,110 -s 192.168.20.3 -j REJECT iptables -A Filter -p tcp --source-port 2:80 -s 192.168.20.3 -j REJECT</span><br><span class="line"></span><br><span class="line">指定时间上网</span><br><span class="line"> iptables -A Filter -s 10.10.10.253 -m time --timestart 6:00 --timestop 11:00 --days Mon,Tue,Wed,Thu,Fri,Sat,Sun -j DROP</span><br><span class="line"> iptables -A Filter -m time --timestart 12:00 --timestop 13:00 --days Mon,Tue,Wed,Thu,Fri,Sat,Sun -j ACCEPT</span><br><span class="line"> iptables -A Filter -m time --timestart 17:30 --timestop 8:30 --days Mon,Tue,Wed,Thu,Fri,Sat,Sun -j ACCEPT</span><br><span class="line"></span><br><span class="line">禁止多个端口服务</span><br><span class="line"> iptables -A Filter -m multiport -p tcp --dport 21,23,80 -j ACCEPT</span><br><span class="line"></span><br><span class="line">将WAN 口NAT到PC</span><br><span class="line"> iptables -t nat -A PREROUTING -i $INTERNET_IF -d $INTERNET_ADDR -j DNAT --to-destination 192.168.0.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> 将WAN口8000端口NAT到192。168。100。200的80端口</span><br><span class="line"> iptables -t nat -A PREROUTING -p tcp --dport 8000 -d $INTERNET_ADDR -j DNAT --to-destination 192.168.100.200:80</span><br><span class="line"></span><br><span class="line">MAIL服务器要转的端口</span><br><span class="line"> iptables -t nat -A PREROUTING -p tcp --dport 110 -d $INTERNET_ADDR -j DNAT --to-destination 192.168.100.200:110</span><br><span class="line"> iptables -t nat -A PREROUTING -p tcp --dport 25 -d $INTERNET_ADDR -j DNAT --to-destination 192.168.100.200:25</span><br><span class="line"></span><br><span class="line">只允许PING 202。96。134。133,别的服务都禁止</span><br><span class="line"> iptables -A Filter -p icmp -s 192.168.100.200 -d 202.96.134.133 -j ACCEPT</span><br><span class="line"> iptables -A Filter -j DROP</span><br><span class="line"></span><br><span class="line">禁用BT配置</span><br><span class="line"> iptables –A Filter –p tcp –dport 6000:20000 –j DROP</span><br><span class="line"></span><br><span class="line">禁用QQ防火墙配置</span><br><span class="line"> iptables -A Filter -p udp --dport ! 53 -j DROP</span><br><span class="line"> iptables -A Filter -d 218.17.209.0/24 -j DROP</span><br><span class="line"> iptables -A Filter -d 218.18.95.0/24 -j DROP</span><br><span class="line"> iptables -A Filter -d 219.133.40.177 -j DROP</span><br><span class="line"></span><br><span class="line">基于MAC，只能收发邮件，其它都拒绝</span><br><span class="line"> iptables -I Filter -m mac --mac-source 00:0A:EB:97:79:A1 -j DROP</span><br><span class="line"> iptables -I Filter -m mac --mac-source 00:0A:EB:97:79:A1 -p tcp --dport 25 -j ACCEPT</span><br><span class="line"> iptables -I Filter -m mac --mac-source 00:0A:EB:97:79:A1 -p tcp --dport 110 -j ACCEPT</span><br><span class="line"></span><br><span class="line">禁用MSN配置</span><br><span class="line"> iptables -A Filter -p udp --dport 9 -j DROP</span><br><span class="line"> iptables -A Filter -p tcp --dport 1863 -j DROP</span><br><span class="line"> iptables -A Filter -p tcp --dport 80 -d 207.68.178.238 -j DROP</span><br><span class="line"> iptables -A Filter -p tcp --dport 80 -d 207.46.110.0/24 -j DROP</span><br><span class="line"></span><br><span class="line">只允许PING 202。96。134。133 其它公网IP都不许PING</span><br><span class="line"> iptables -A Filter -p icmp -s 192.168.100.200 -d 202.96.134.133 -j ACCEPT</span><br><span class="line"> iptables -A Filter -p icmp -j DROP</span><br><span class="line"></span><br><span class="line">禁止某个MAC地址访问internet:</span><br><span class="line"> iptables -I Filter -m mac --mac-source 00:20:18:8F:72:F8 -j DROP</span><br><span class="line"></span><br><span class="line">禁止某个IP地址的PING:</span><br><span class="line"> iptables –A Filter –p icmp –s 192.168.0.1 –j DROP</span><br><span class="line"></span><br><span class="line">禁止某个IP地址服务：</span><br><span class="line"> iptables –A Filter -p tcp -s 192.168.0.1 --dport 80 -j DROP</span><br><span class="line"> iptables –A Filter -p udp -s 192.168.0.1 --dport 53 -j DROP</span><br><span class="line"></span><br><span class="line">只允许某些服务，其他都拒绝(2条规则)</span><br><span class="line"> iptables -A Filter -p tcp -s 192.168.0.1 --dport 1000 -j ACCEPT</span><br><span class="line"> iptables -A Filter -j DROP</span><br><span class="line"></span><br><span class="line">禁止某个IP地址的某个端口服务</span><br><span class="line"> iptables -A Filter -p tcp -s 10.10.10.253 --dport 80 -j ACCEPT</span><br><span class="line"> iptables -A Filter -p tcp -s 10.10.10.253 --dport 80 -j DROP</span><br><span class="line"></span><br><span class="line">禁止某个MAC地址的某个端口服务</span><br><span class="line"></span><br><span class="line">iptables -I Filter -p tcp -m mac --mac-source 00:20:18:8F:72:F8 --dport 80 -j DROP</span><br><span class="line"></span><br><span class="line">禁止某个MAC地址访问internet:</span><br><span class="line"> iptables -I Filter -m mac --mac-source 00:11:22:33:44:55 -j DROP</span><br><span class="line"></span><br><span class="line">禁止某个IP地址的PING:</span><br><span class="line"> iptables –A Filter –p icmp –s 192.168.0.1 –j DROP</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://yclyyds.top">Yang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://yclyyds.top/2023/10/26/%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/">http://yclyyds.top/2023/10/26/%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/four.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/10/27/%E5%B7%A5%E6%8E%A7%E4%BA%92%E8%81%94%E5%AE%89%E5%85%A8%E5%AE%9A%E7%BA%A7/" title="工控互联安全定级"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Previous</div><div class="prev_info">工控互联安全定级</div></div></a></div><div class="next-post pull-right"><a href="/2023/10/26/Linux%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/" title="安全加固"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Next</div><div class="next_info">安全加固</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/four.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Yang</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">9</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81iptables-%E5%86%85%E7%BD%AE4%E4%B8%AA%E8%A1%A8"><span class="toc-number">1.</span> <span class="toc-text">一、iptables 内置4个表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81netstat%E8%AF%AD%E6%B3%95"><span class="toc-number">2.</span> <span class="toc-text">二、netstat语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81iptables%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%8A%A0%E5%9B%BA"><span class="toc-number">3.</span> <span class="toc-text">三、iptables常用命令加固</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%9F%A5%E7%9C%8Biptables%E7%8A%B6%E6%80%81"><span class="toc-number">3.1.</span> <span class="toc-text">2.查看iptables状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BF%9D%E5%AD%98iptables%E8%A7%84%E5%88%99"><span class="toc-number">3.2.</span> <span class="toc-text">3.保存iptables规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%B8%85%E9%99%A4iptables%E8%A7%84%E5%88%99"><span class="toc-number">3.3.</span> <span class="toc-text">4.清除iptables规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E7%A6%81%E7%94%A8ping%E8%A7%84%E5%88%99"><span class="toc-number">3.4.</span> <span class="toc-text">5.禁用ping规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E7%9B%AE%E7%9A%84%E7%AB%AF%E5%8F%A3%E4%B8%8D%E5%8F%AF%E8%BE%BE"><span class="toc-number">3.5.</span> <span class="toc-text">6.目的端口不可达</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E9%98%B2%E6%B4%AA%E6%B0%B4%E6%94%BB%E5%87%BB"><span class="toc-number">3.6.</span> <span class="toc-text">7.防洪水攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E5%88%A9%E7%94%A8recent%E6%A8%A1%E5%9D%97%E9%98%B2%E5%BE%A1ssh%E5%AD%97%E5%85%B8%E6%94%BB%E5%87%BB"><span class="toc-number">3.7.</span> <span class="toc-text">8.利用recent模块防御ssh字典攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-%E5%85%81%E8%AE%B8%E6%9F%90%E4%B8%AAip%E8%AE%BF%E9%97%AE%E6%9F%90%E4%B8%AA%E7%AB%AF%E5%8F%A3"><span class="toc-number">3.8.</span> <span class="toc-text">9.允许某个ip访问某个端口</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/06/Linux%E6%9F%A5%E6%97%A5%E5%BF%97/" title="Linux查日志">Linux查日志</a><time datetime="2023-11-06T08:40:11.739Z" title="Created 2023-11-06 16:40:11">2023-11-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/06/%E7%9B%AE%E5%BD%95%E8%B7%AF%E5%BE%84%E6%89%8B%E6%B5%8B/" title="目录手测">目录手测</a><time datetime="2023-11-06T05:24:12.589Z" title="Created 2023-11-06 13:24:12">2023-11-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/10/27/xss/" title="XSS常见标签语句">XSS常见标签语句</a><time datetime="2023-10-27T06:55:37.786Z" title="Created 2023-10-27 14:55:37">2023-10-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/10/27/%E5%B7%A5%E6%8E%A7%E5%AE%9A%E7%BA%A7/" title="工控定级">工控定级</a><time datetime="2023-10-27T02:07:45.000Z" title="Created 2023-10-27 10:07:45">2023-10-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/10/27/%E5%B7%A5%E6%8E%A7%E4%BA%92%E8%81%94%E5%AE%89%E5%85%A8%E5%AE%9A%E7%BA%A7/" title="工控互联安全定级">工控互联安全定级</a><time datetime="2023-10-27T00:10:56.270Z" title="Created 2023-10-27 08:10:56">2023-10-27</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Yang</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>